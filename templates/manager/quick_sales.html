{% extends "base.html" %}

{% block title %}Manage Quick Sales{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2 style="margin: 0;">Quick Sale Items</h2>
    <button class="btn btn-primary" onclick="showAddQuickSaleModal()">➕ Add Quick Sale Item</button>
</div>

<div class="card">
    <div class="card-body" style="padding: 0;">
        <table class="cart-table">
            <thead>
                <tr>
                    <th>Icon</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Category</th>
                    <th>Order</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for item in quick_items %}
                <tr>
                    <td style="font-size: 24px; text-align: center;">{{ item.icon }}</td>
                    <td>{{ item.name }}</td>
                    <td>${{ "%.2f"|format(item.price) }}</td>
                    <td>{{ item.category or '-' }}</td>
                    <td>{{ item.display_order }}</td>
                    <td>
                        {% if item.is_active %}
                        <span style="color: #10b981; font-weight: 600;">Active</span>
                        {% else %}
                        <span style="color: #64748b;">Inactive</span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;" onclick="editQuickSaleItem({{ item.id }})">✏️ Edit</button>
                        {% if item.is_active %}
                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 13px;" onclick="deleteQuickSaleItem({{ item.id }})">🗑️ Delete</button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Add/Edit Quick Sale Modal -->
<div id="quickSaleModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: white; border-radius: 12px; padding: 30px; width: 90%; max-width: 500px;">
        <h3 style="margin-bottom: 20px;" id="modalTitle">Add Quick Sale Item</h3>
        <form id="quickSaleForm" onsubmit="saveQuickSaleItem(event)">
            <input type="hidden" id="itemId">

            <div style="margin-bottom: 16px;">
                <label style="font-size: 13px; color: #64748b; margin-bottom: 6px; display: block;">Item Name</label>
                <input type="text" id="itemName" required style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
            </div>

            <div style="margin-bottom: 16px;">
                <label style="font-size: 13px; color: #64748b; margin-bottom: 6px; display: block;">Price</label>
                <input type="number" id="itemPrice" step="0.01" min="0" required style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
            </div>

            <div style="margin-bottom: 16px;">
                <label style="font-size: 13px; color: #64748b; margin-bottom: 6px; display: block;">Category</label>
                <input type="text" id="itemCategory" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
            </div>

            <div style="margin-bottom: 16px;">
                <label style="font-size: 13px; color: #64748b; margin-bottom: 6px; display: block;">Icon (Emoji)</label>
                <input type="text" id="itemIcon" maxlength="2" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 24px; text-align: center;">
                <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Common: ❄️ 🥤 🚬 🔥 📄 🛍️ ⚡ 💧 🍺 🍷 🥃 🍕 🍔 🌮</div>
            </div>

            <div style="margin-bottom: 16px;">
                <label style="font-size: 13px; color: #64748b; margin-bottom: 6px; display: block;">Display Order</label>
                <input type="number" id="itemOrder" min="0" value="0" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeQuickSaleModal()">Cancel</button>
                <button type="submit" class="btn btn-primary" style="flex: 1;">Save</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showAddQuickSaleModal() {
    document.getElementById('modalTitle').textContent = 'Add Quick Sale Item';
    document.getElementById('quickSaleForm').reset();
    document.getElementById('itemId').value = '';
    document.getElementById('itemIcon').value = '📦';
    document.getElementById('quickSaleModal').style.display = 'flex';
}

async function editQuickSaleItem(itemId) {
    const response = await fetch(`/api/quick-sale/${itemId}`);
    const data = await response.json();

    if (data.success) {
        const item = data.item;
        document.getElementById('modalTitle').textContent = 'Edit Quick Sale Item';
        document.getElementById('itemId').value = item.id;
        document.getElementById('itemName').value = item.name;
        document.getElementById('itemPrice').value = item.price;
        document.getElementById('itemCategory').value = item.category || '';
        document.getElementById('itemIcon').value = item.icon;
        document.getElementById('itemOrder').value = item.display_order;
        document.getElementById('quickSaleModal').style.display = 'flex';
    } else {
        showError('Failed to load item', 'Error');
    }
}

async function saveQuickSaleItem(event) {
    event.preventDefault();

    const itemId = document.getElementById('itemId').value;
    const data = {
        name: document.getElementById('itemName').value,
        price: parseFloat(document.getElementById('itemPrice').value),
        category: document.getElementById('itemCategory').value,
        icon: document.getElementById('itemIcon').value || '📦',
        display_order: parseInt(document.getElementById('itemOrder').value) || 0
    };

    const url = itemId ? `/api/quick-sale/${itemId}` : '/api/quick-sale';
    const method = itemId ? 'PUT' : 'POST';

    const response = await fetch(url, {
        method: method,
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });

    const result = await response.json();

    if (result.success) {
        showSuccess(itemId ? 'Quick sale item updated successfully!' : 'Quick sale item added successfully!', 'Success');
        closeQuickSaleModal();
        setTimeout(() => location.reload(), 1000);
    } else {
        showError(result.message || 'Failed to save item', 'Error');
    }
}

async function deleteQuickSaleItem(itemId) {
    showConfirm(
        'Are you sure you want to delete this quick sale item?',
        'Confirm Delete',
        async function() {
            const response = await fetch(`/api/quick-sale/${itemId}`, {
                method: 'DELETE'
            });

            const result = await response.json();

            if (result.success) {
                showSuccess('Quick sale item deleted successfully!', 'Success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showError(result.message || 'Failed to delete item', 'Error');
            }
        }
    );
}

function closeQuickSaleModal() {
    document.getElementById('quickSaleModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('quickSaleModal');
    if (event.target === modal) {
        closeQuickSaleModal();
    }
}
</script>
{% endblock %}
